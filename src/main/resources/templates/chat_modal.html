<head>
    <script>
        // sendChat 함수 정의
        function sendChat() {
            // Your chat sending logic
            console.log("Chat sent");
        }

        // 메시지 박스를 표시하는 버튼 이벤트 리스너
        document.querySelector('#toggleButton').addEventListener('click', function() {
            const messageBox = document.getElementById('messageBox');
            if (messageBox.classList.contains('visible')) {
                messageBox.classList.remove('visible');
                this.innerHTML = '<img src="/img/message.png" alt="" style="width: 20px; height: 20px;">';
            } else {
                messageBox.classList.add('visible');
                this.innerHTML = '<img src="/img/v.png" alt="" style="width: 20px; height: 20px;">';
            }
        });
    </script>
    <script>
        function searchMemberAndShowModal() {
            const memberId = document.getElementById('searchInput').value;

            fetch('/member/searchId', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `memberId=${encodeURIComponent(memberId)}`,
            })
            .then(response => response.json())
            .then(data => {
                // 여기서 모달에 검색 결과를 표시하는 JavaScript 코드 작성
                const modalContent = document.getElementById('modalContent');
                modalContent.innerHTML = ''; // 기존 내용 초기화

                data.forEach(member => {
                    const memberElement = document.createElement('p');
                    memberElement.textContent = member.name; // 예시: 멤버 객체의 필드에 맞게 수정

                    modalContent.appendChild(memberElement);
                });

                // 모달을 보여주는 JavaScript 코드 작성 (예: Bootstrap Modal 사용 시)
                $('#myModal').modal('show');
            })
            .catch(error => console.error('Error fetching search results:', error));
        }
    </script>
</head>
<body>
<div th:fragment="chat">
    <div class="message-box" id="messageBox">
        <div class="message-box-header flex justify-between items-center">
            <strong>메시지</strong>
            <!-- You can open the modal using ID.showModal() method -->
            <div onclick="searchModal.showModal()">
                <img class="option-icon" src="/img/search.png" style="width: 20px; height: 20px;">
            </div>

            <dialog id="searchModal" class="modal">
                <div class="modal-box">
                    <!-- 모달 닫기 버튼 -->
                    <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2" onclick="searchModal.close()">✕</button>

                    <!-- 검색 폼 -->
                    <form th:action="@{/member/search}" class="flex items-center gap-2" method="post">
                        <input type="hidden" id="isSearchModal" name="isSearchModal" th:value="${isSearchModal}">
                        <input type="text" name="memberId" placeholder="회원 검색">
                        <input type="submit" value="검색">
                    </form>

                    <!-- 검색 결과 목록 -->
                    <ul th:if="${searchLoginId != null}" th:with="itemHover='hover:bg-gray-100  p-[10px] flex w-full', itemAnchorClass='inline-block w-full h-full'">
                        <li th:each="member : ${searchLoginId}" th:class="${itemHover}">
                            <a th:href="@{|/chat/create/${member.id}|}" th:text="${member.loginId}" th:class="${itemAnchorClass}"></a>
                        </li>
                    </ul>
                </div>
            </dialog>

        </div>
        <div class="message-box-content">
            <div th:each="member : ${memberList}">
                <a th:href="@{|/chat/create/${member.id}|}" th:text="${member.loginId}"></a>
            </div>
        </div>
    </div>

    <!-- 메시지 창을 표시하는 버튼 -->
    <button class="toggle-button" id="toggleButton">
        <img src="/img/message.png" alt="" style="width: 20px; height: 20px;">
    </button>

</div>
</body>
